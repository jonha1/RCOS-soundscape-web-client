/*! For license information please see bundle.js.LICENSE.txt */
document.write('<script src="https://unpkg.com/leaflet/dist/leaflet.js"><\/script>'),document.write('<script src="https://unpkg.com/@turf/turf@6/turf.min.js"><\/script>'),(()=>{"use strict";function t(){t=function(){return n};var r,n={},o=Object.prototype,i=o.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(r){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),c=new I(n||[]);return a(i,"_invoke",{value:O(t,r,c)}),i}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}n.wrap=h;var p="suspendedStart",y="suspendedYield",v="executing",g="completed",m={};function w(){}function b(){}function x(){}var E={};f(E,u,(function(){return this}));var L=Object.getPrototypeOf,k=L&&L(L(F([])));k&&k!==o&&i.call(k,u)&&(E=k);var S=x.prototype=w.prototype=Object.create(E);function P(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,r){function n(o,a,c,u){var s=d(t[o],t,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==e(f)&&i.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,c,u)}),(function(t){n("throw",t,c,u)})):r.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return n("throw",t,c,u)}))}u(s.arg)}var o;a(this,"_invoke",{value:function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}})}function O(t,e,n){var o=p;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:r,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===m)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=d(t,e,n);if("normal"===s.type){if(o=n.done?g:y,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=g,n.method="throw",n.arg=s.arg)}}}function j(t,e){var n=e.method,o=t.iterator[n];if(o===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=r,j(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=d(o,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,m):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function F(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function e(){for(;++o<t.length;)if(i.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=r,e.done=!0,e};return a.next=a}}throw new TypeError(e(t)+" is not iterable")}return b.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,l,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},n.awrap=function(t){return{__await:t}},P(_.prototype),f(_.prototype,s,(function(){return this})),n.AsyncIterator=_,n.async=function(t,e,r,o,i){void 0===i&&(i=Promise);var a=new _(h(t,e,r,o),i);return n.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},P(S),f(S,l,"Generator"),f(S,u,(function(){return this})),f(S,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},n.values=F,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(N),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return c.type="throw",c.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),s=i.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),N(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:F(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),m}},n}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function n(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function c(t){r(a,o,i,c,u,"next",t)}function u(t){r(a,o,i,c,u,"throw",t)}c(void 0)}))}}var o=new(window.AudioContext||window.webkitAudioContext),i=null,a=null,c={};function u(t){return s.apply(this,arguments)}function s(){return(s=n(t().mark((function e(r){var n,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c[r]){t.next=17;break}return t.prev=1,t.next=4,fetch(r);case 4:return n=t.sent,t.next=7,n.arrayBuffer();case 7:return i=t.sent,t.next=10,o.decodeAudioData(i);case 10:c[r]=t.sent,t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(1),console.error("Error loading sound:",t.t0),t.abrupt("return");case 17:return t.abrupt("return",c[r]);case 18:case"end":return t.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function l(t,e,r){return i&&i.stop(),new Promise((function(n){var a=function(t,e,r){var n=o.createBufferSource(),i=o.createPanner();return i.setPosition(e,r,0),n.connect(i),i.connect(o.destination),n.buffer=t,n}(t,e,r);a.onended=function(){return n()},a.start(),i=a}))}function f(t,e,r,n,o){return a&&speechSynthesis.cancel(),new Promise((function(n){var o=new SpeechSynthesisUtterance(t);r&&(o.rate=r),e&&(o.voice=e),o.onend=function(){return n()},speechSynthesis.speak(o),a=o}))}function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function d(){d=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",y="suspendedYield",v="executing",g="completed",m={};function w(){}function b(){}function x(){}var E={};s(E,a,(function(){return this}));var L=Object.getPrototypeOf,k=L&&L(L(F([])));k&&k!==r&&n.call(k,a)&&(E=k);var S=x.prototype=w.prototype=Object.create(E);function P(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==h(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=p;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===m)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?g:y,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=g,n.method="throw",n.arg=s.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function F(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(h(e)+" is not iterable")}return b.prototype=x,o(S,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=s(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,s(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},P(_.prototype),s(_.prototype,c,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},P(S),s(S,u,"Generator"),s(S,a,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=F,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),N(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:F(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function p(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function y(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){p(i,n,o,a,c,"next",t)}function c(t){p(i,n,o,a,c,"throw",t)}a(void 0)}))}}var v=1,g="TileCache";function m(){return w.apply(this,arguments)}function w(){return(w=y(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var r=indexedDB.open(g,v);r.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains("urls")||e.createObjectStore("urls",{keyPath:"url"}),e.objectStoreNames.contains("features")||e.createObjectStore("features",{keyPath:"id",autoIncrement:!0});var r=t.currentTarget.transaction.objectStore("features");r.createIndex("tile","tile",{unique:!1}),r.createIndex("osm_ids","osm_ids",{multiEntry:!0})},r.onsuccess=function(e){var r=e.target.result;t(r)},r.onerror=function(t){e("Error opening database: ".concat(t.target.error))}})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var b,x,E,k={db:null,clear:function(){return t="features",(e=indexedDB.open(g)).onsuccess=function(e){var r=e.target.result.transaction([t],"readwrite").objectStore(t).clear();r.onsuccess=function(){console.log("Data cleared successfully.")},r.onerror=function(t){console.error("Error clearing data:",t)}},void(e.onerror=function(t){console.error("Error opening database:",t)});var t,e},fetch:function(t){function e(e,r){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){return new Promise(function(){var r=y(d().mark((function r(n,o){var i,a,c;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(k.db){r.next=4;break}return r.next=3,m();case 3:k.db=r.sent;case 4:i=k.db.transaction(["urls"],"readwrite"),a=i.objectStore("urls"),(c=a.get(t)).onsuccess=function(){var r=y(d().mark((function r(i){var a,c,u,s,l,f,h,p;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(a=i.target.result)){r.next=13;break}if(c=(new Date).getTime(),u=a.lastFetchTime||0,!(c-u<6048e5)){r.next=9;break}return console.log("HIT: ",t),r.abrupt("return");case 9:console.log("STALE: ",t),k.deleteFeatures(e);case 11:r.next=14;break;case 13:console.log("MISS: ",t);case 14:return r.prev=14,r.next=17,fetch(t);case 17:return s=r.sent,r.next=20,s.json();case 20:l=r.sent,f=k.db.transaction(["urls"],"readwrite"),h=f.objectStore("urls"),(p=h.put({url:t,lastFetchTime:(new Date).getTime()})).onsuccess=function(){console.log("Fetched: ",t),n(l)},p.onerror=function(t){o("Error updating cache: ".concat(t.target.error))},r.next=31;break;case 28:r.prev=28,r.t0=r.catch(14),o("Error fetching URL: ".concat(r.t0));case 31:case"end":return r.stop()}}),r,null,[[14,28]])})));return function(t){return r.apply(this,arguments)}}(),c.onerror=function(t){o("Error checking cache: ".concat(t.target.error))};case 9:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}())})),addFeature:function(t,e){return new Promise(function(){var r=y(d().mark((function r(n,o){var i,a,c;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(k.db){r.next=4;break}return r.next=3,m();case 3:k.db=r.sent;case 4:i=k.db.transaction(["features"],"readwrite"),a=i.objectStore("features"),t.tile=e,(c=a.add(t)).onsuccess=function(){n()},c.onerror=function(t){o(t.target.error)};case 10:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}())},getFeatures:(E=y(d().mark((function t(e){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=y(d().mark((function t(r,n){var o,i,a,c,u,s;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(k.db){t.next=4;break}return t.next=3,m();case 3:k.db=t.sent;case 4:o=k.db.transaction(["features"],"readonly"),i=o.objectStore("features"),a=i.index("tile"),c=IDBKeyRange.only(e.key),u=a.openCursor(c),s=[],u.onsuccess=function(t){var e=t.target.result;e?(s.push(e.value),e.continue()):r(s)},u.onerror=function(t){n(t.target.error)};case 12:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)}))),function(t){return E.apply(this,arguments)}),deleteFeatures:(x=y(d().mark((function t(e){var r,n,o,i,a,c;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(k.db){t.next=4;break}return t.next=3,m();case 3:k.db=t.sent;case 4:r=k.db.transaction(["features"],"readwrite"),n=r.objectStore("features"),o=n.index("tile"),i=IDBKeyRange.only(e),a=o.openCursor(i),c=0,a.onsuccess=function(t){var e=t.target.result;e&&(n.delete(e.primaryKey),c++,e.continue())},r.oncomplete=function(t){console.log("Purged ".concat(c," stale features from cache."))};case 12:case"end":return t.stop()}}),t)}))),function(t){return x.apply(this,arguments)}),getFeatureByOsmId:(b=y(d().mark((function t(e){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=y(d().mark((function t(r,n){var o,i,a,c,u;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(k.db){t.next=4;break}return t.next=3,m();case 3:k.db=t.sent;case 4:o=k.db.transaction(["features"],"readonly"),i=o.objectStore("features"),a=i.index("osm_ids"),c=IDBKeyRange.only(e),(u=a.openCursor(c)).onsuccess=function(t){var e=t.target.result;e?1==e.value.osm_ids.length?r(e.value):e.continue():r(null)},u.onerror=function(t){n(t.target.error)};case 11:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)}))),function(t){return b.apply(this,arguments)})};const S=k,P="production"==("soundscape-community.github.io"===window.location.hostname?"production":"testing")?{tileServer:"https://tiles.soundscape.services"}:{tileServer:"http://localhost:8080/tiles"};function _(t,e,r){var n=1<<r;return{x:Math.floor((e+180)/360*n),y:Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*n),z:r}}function O(t){return navigator.geolocation.watchPosition((function(e){console.log(e),t(e.coords.latitude,e.coords.longitude,e.coords.heading)}),(function(t){t.code==t.PERMISSION_DENIED?alert("Could not get your location. If you did not see a permission request, make sure your browser is not configured to always block location services."):console.error("Error getting current position: "+t.message)}),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0})}function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function T(){T=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",d="suspendedYield",p="executing",y="completed",v={};function g(){}function m(){}function w(){}var b={};s(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(F([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=g.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==j(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=h;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=_(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:d,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function _(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,_(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function F(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(j(e)+" is not iterable")}return m.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:m,configurable:!0}),m.displayName=s(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=F,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),N(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:F(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function N(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return I(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function F(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function M(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){F(i,n,o,a,c,"next",t)}function c(t){F(i,n,o,a,c,"throw",t)}a(void 0)}))}}var A=new Set;function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function G(){G=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",d="suspendedYield",p="executing",y="completed",v={};function g(){}function m(){}function w(){}var b={};s(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=g.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==C(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=h;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=_(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:d,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function _(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,_(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(C(e)+" is not iterable")}return m.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:m,configurable:!0}),m.displayName=s(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function D(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function U(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){D(i,n,o,a,c,"next",t)}function c(t){D(i,n,o,a,c,"throw",t)}a(void 0)}))}}const q=function(t){var e={keys:new Set,queue:[],max_size:100,key:function(t){return t.join("|")},add:function(t){if(this.keys.size>this.max_size){var e=this.queue.shift();this.keys.delete(e)}this.keys.add(this.key(t)),this.queue.push(this.key(t))},has:function(t){return this.keys.has(this.key(t))}};function r(r){return r.centroid=turf.centroid(r.geometry),r.distance=t.locationProvider.distance(r.centroid,{units:"meters"}),r.soundEffect="sense_poi",r.getAudioLabel=U(G().mark((function t(){return G().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=r.feature_type,t.next="highway"===t.t0?3:10;break;case 3:t.t1=r.feature_value,t.next="gd_intersection"===t.t1?6:"bus_stop"===t.t1?8:9;break;case 6:return t.abrupt("return",(e=r,Promise.all(e.osm_ids.map((function(t){return S.getFeatureByOsmId(t)}))).then((function(t){return new Set(t.filter((function(t){return t&&void 0!==t.properties.name})).map((function(t){return t.properties.name})))}))).then((function(t){if(t.size>1)return"Intersection: "+(e=t,function(t){if(Array.isArray(t))return B(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return B(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?B(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).join(", ");var e})));case 8:return t.abrupt("break",9);case 9:return t.abrupt("break",11);case 10:return t.abrupt("return",r.properties.name);case 11:case"end":return t.stop()}var e}),t)}))),r.announce=function(n){return r.getAudioLabel().then((function(o){return!!o&&(e.add(r.osm_ids),i=r.soundEffect,a=o,c=r.centroid,u=n.includeDistance,t.addToQueue({soundUrl:"app/sounds/".concat(i,".wav"),location:c}),t.addToQueue({text:a,location:c,includeDistance:u}),!0);var i,a,c,u}))},r}var n={nearbyFeatures:function(t,e,n){return Promise.all(function(t,e,r){var n=function(t,e,r){var n=turf.point([e,t]),o=turf.buffer(n,r,{units:"meters"});return turf.bbox(o)}(t,e,r);return function(t,e,r){for(var n=[],o=16;o<=16;o++)for(var i=_(t[3],t[0],o),a=_(t[1],t[2],o),c=i.x;c<=a.x;c++)for(var u=i.y;u<=a.y;u++)n.push({x:c,y:u,z:o});return n}(n).map((function(t){return function(t,e,r){var n,o={x:t,y:e,z:r,key:"".concat(r,"/").concat(t,"/").concat(e),load:(n=M(T().mark((function t(){var e;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!A.has(o.key)){t.next=2;break}return t.abrupt("return");case 2:A.add(o.key),e="".concat(P.tileServer,"/").concat(o.key,".json"),S.fetch(e,o.key).then((function(t){var e,r=N(t.features);try{for(r.s();!(e=r.n()).done;){var n=e.value;S.addFeature(n,o.key)}}catch(t){r.e(t)}finally{r.f()}console.log("Loaded ".concat(t.features.length," new features."))})).catch((function(t){console.error(t),A.delete(o.key)}));case 5:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)}),getFeatures:function(){var t=M(T().mark((function t(){return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",S.getFeatures(o));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()};return o}(t.x,t.y,t.z)}))}(t,e,n).map((function(t){return t.load(),t.getFeatures()}))).then((function(t){return t.reduce((function(t,e){return t.concat(e)}),[]).map(r).filter((function(t){return t.distance<n})).sort((function(t,e){return t.distance-e.distance}))}))},calloutAllFeatures:function(e,r){var o=2*t.locationProvider.radiusMeters;return n.nearbyFeatures(e,r,o).then((function(t){return Promise.all(t.map((function(t){return t.announce({includeDistance:!0})}))).then((function(t){return t.some((function(t){return t}))}))}))},calloutNewFeatures:function(r,o){var i=t.locationProvider.radiusMeters;n.nearbyFeatures(r,o,i).then((function(t){t.filter((function(t){return!e.has(t.osm_ids)})).forEach((function(t){return t.announce({includeDistance:!1})}))}))},locationChanged:function(t){return n.calloutNewFeatures(t.detail.latitude,t.detail.longitude)}};return n};function z(t){if(window.DeviceOrientationEvent){var e=function(e){if(e.absolute&&null!=e.alpha&&null!=e.beta&&null!=e.gamma){var n=-(e.alpha+e.beta*e.gamma/90);n-=360*Math.floor(n/360),window.removeEventListener("deviceorientation",r),t(n)}},r=function(r){var n=r.webkitCompassHeading;null==n||isNaN(n)||(t(n),window.removeEventListener("deviceorientationabsolute",e))};"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t?n():console.warn("Permission for DeviceMotionEvent not granted")})):n()}else console.warn("DeviceOrientation API not available");function n(){window.addEventListener("deviceorientationabsolute",e),window.addEventListener("deviceorientation",r)}}const R=function(t,e){var r=null,n={elem:document.getElementById("recentCalloutsList"),clear:function(){n.elem.innerHTML=""},add:function(o,i,a){var c=document.createElement("li");c.innerHTML=" "+o;var u=document.createElement("button");u.innerHTML="🔊",u.title="Start beacon",c.insertBefore(u,c.firstChild),u.addEventListener("click",(function(){r?r.stop():function(t){var e=document.createElement("p"),n=document.createElement("button");n.setAttribute("id","toggleBeacon"),n.innerText="⏸",e.appendChild(n);var o=document.createElement("span");o.setAttribute("id","currentBeacon"),e.appendChild(o),t.insertBefore(e,t.firstChild),n.addEventListener("click",(function(t){"⏸"==t.target.innerText?(r.stop(),t.target.innerText="▶"):(r.start(),t.target.innerText="⏸")}))}(document.getElementById("recentCalloutsArea")),r=function(t,e,r,n){var o=turf.point([e,t]),i=r.normalizedRelativePosition(o),a=null,c=new(window.AudioContext||window.webkitAudioContext),u=c.createPanner(),s=new Audio("app/sounds/beacons/Classic/Classic_OnAxis.wav"),l=new Audio("app/sounds/beacons/Classic/Classic_OffAxis.wav");s.loop=!0,s.muted=!0,l.loop=!0;var f=c.createMediaElementSource(s),h=c.createMediaElementSource(l);f.connect(u),h.connect(u),u.connect(c.destination);var d={start:function(){s.play(),l.play()},stop:function(){s.pause(),l.pause()},recomputePosition:function(){i=r.normalizedRelativePosition(o),u.setPosition(i.x,i.y,0)}};return s.addEventListener("timeupdate",(function(){if(s.currentTime<.1){var t=r.distance(o,{units:"meters"});if(t<10)d.stop(),new Audio("app/sounds/SS_beaconFound2_48k.wav").play();else if(Math.abs(a-t)>50)n.isPlaying||(a=t,n.addToQueue({soundUrl:"app/sounds/sense_mobility.wav"}),n.addToQueue({text:"Beacon: ".concat(t.toFixed(0)," meters")}));else{var e=180*Math.atan2(i.x,i.y)/Math.PI;Math.abs(e)<30?(s.muted=!1,l.muted=!0):(s.muted=!0,l.muted=!1)}}})),r.events.addEventListener("locationUpdated",d.recomputePosition),r.events.addEventListener("orientationUpdated",d.recomputePosition),d}(i,a,t,e),r.start(),function(t){document.getElementById("currentBeacon").innerText=" "+t,document.getElementById("toggleBeacon").innerText="⏸"}(o)})),n.elem.insertBefore(c,n.elem.firstChild),n.elem.children.length>25&&n.elem.removeChild(n.elem.lastChild)}};return n};function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function Q(){Q=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",d="suspendedYield",p="executing",y="completed",v={};function g(){}function m(){}function w(){}var b={};s(b,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(b=E);var L=w.prototype=g.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Y(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=h;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=_(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:d,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function _(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,_(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Y(e)+" is not iterable")}return m.prototype=w,o(L,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:m,configurable:!0}),m.displayName=s(w,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function H(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function V(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){H(i,n,o,a,c,"next",t)}function c(t){H(i,n,o,a,c,"throw",t)}a(void 0)}))}}document.addEventListener("DOMContentLoaded",(function(){var r=function(){var t={radiusMeters:40,heading:null,events:new EventTarget,updateLocation:function(e,r){t.latitude=e,t.longitude=r;var n=new CustomEvent("locationUpdated",{detail:{latitude:t.latitude,longitude:t.longitude}});t.events.dispatchEvent(n)},updateOrientation:function(e){t.heading=e;var r=new CustomEvent("orientationUpdated",{detail:{heading:t.heading}});t.events.dispatchEvent(r)},turfPoint:function(){return turf.point([t.longitude,t.latitude])},relativePosition:function(e){return r=t.turfPoint(),n=t.heading,a=(i=function(t){return t*(Math.PI/180)})((o=e).geometry.coordinates[1]-r.geometry.coordinates[1]),c=i(o.geometry.coordinates[0]-r.geometry.coordinates[0]),u=Math.sin(a/2)*Math.sin(a/2)+Math.cos(i(r.geometry.coordinates[1]))*Math.cos(i(o.geometry.coordinates[1]))*Math.sin(c/2)*Math.sin(c/2),s=2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3,l=Math.atan2(o.geometry.coordinates[0]-r.geometry.coordinates[0],o.geometry.coordinates[1]-r.geometry.coordinates[1])-i(n),{x:s*Math.sin(l)*.05,y:s*Math.cos(l)*.05};var r,n,o,i,a,c,u,s,l},normalizedRelativePosition:function(e){var r=t.relativePosition(e),n=r.x,o=r.y,i=Math.atan2(n,o);return{x:Math.sin(i),y:Math.cos(i)}},distance:function(e,r){return turf.distance(t.turfPoint(),e,r)}};return t}(),o=function(r){var o={queue:[],isPlaying:!1,locationProvider:r,events:new EventTarget,voices:null,voice:null,rate:null,setVoice:function(t){o.voice=o.voices[t]},setRate:function(t){o.rate=t},addToQueue:function(t){o.queue.push(t),o.isPlaying||(o.isPlaying=!0,c())},stopAndClear:function(){o.queue=[],o.isPlaying=!1,i&&i.stop(),a&&speechSynthesis.cancel()}};function c(){return s.apply(this,arguments)}function s(){return(s=n(t().mark((function r(){var n,i,a,s,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==o.queue.length){t.next=3;break}return o.isPlaying=!1,t.abrupt("return");case 3:if(n=o.queue.shift(),i={x:0,y:0},n.location&&(i=o.locationProvider.normalizedRelativePosition(n.location)),n.includeDistance&&(a="feet",s=o.locationProvider.distance(n.location,{units:a}).toFixed(0),n.text+=", ".concat(s," ").concat(a)),"object"!==e(n)||!n.soundUrl){t.next=15;break}return t.next=10,u(n.soundUrl);case 10:return h=t.sent,t.next=13,l(h,i.x||0,i.y||0);case 13:t.next=22;break;case 15:if("object"!==e(n)||!n.text){t.next=21;break}return o.events.dispatchEvent(new CustomEvent("speechPlayed",{detail:n})),t.next=19,f(n.text,o.voice,o.rate,i.x,i.y);case 19:t.next=22;break;case 21:console.error("unrecognized object in audio queue: ".concat(n));case 22:c();case 23:case"end":return t.stop()}}),r)})))).apply(this,arguments)}return o}(r),c=q(o),s=function(t){var e=L.map(t);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(e);var r=L.divIcon({className:"arrow-icon",iconSize:[0,0],iconAnchor:[7,25]}),n=(new L.LayerGroup).addTo(e);return e.plotPoints=function(t,e){n.clearLayers(),t.forEach((function(t){L.circle([t.latitude,t.longitude],{color:"red",fillColor:"#f03",fillOpacity:.3,radius:e}).addTo(n),null===t.heading||isNaN(t.heading)||(L.marker([t.latitude,t.longitude],{icon:r}).addTo(n)._icon.style.transform+=" rotate("+t.heading+"deg)")}))},e.plotMyLocation=function(t){var r=t.latitude,n=t.longitude,o=t.heading,i=t.radiusMeters;isNaN(r)||isNaN(n)||e.plotPoints([{latitude:r,longitude:n,heading:o}],i)},e}("map"),h=R(r,o);function d(){return p.apply(this,arguments)}function p(){return(p=V(Q().mark((function t(){return Q().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var r=new URLSearchParams(window.location.search),n=parseFloat(r.get("lat")),o=parseFloat(r.get("lon")),i=parseFloat(r.get("heading"));isNaN(n)||isNaN(o)||isNaN(i)?new Promise((function(t,e){"geolocation"in navigator?navigator.geolocation.getCurrentPosition((function(e){t({latitude:e.coords.latitude,longitude:e.coords.longitude,heading:e.coords.heading||0})}),(function(t){e("Error getting current position: "+t.message)})):e("Geolocation is not supported by this browser")})).then((function(e){t({latitude:e.latitude,longitude:e.longitude,heading:0})})).catch((function(t){e(t)})):t({latitude:n,longitude:o,heading:i})})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}r.events.addEventListener("locationUpdated",(function(t){s.setView([t.detail.latitude,t.detail.longitude],16),s.plotMyLocation(r)})),r.events.addEventListener("orientationUpdated",(function(t){s.plotMyLocation(r)})),o.events.addEventListener("speechPlayed",(function(t){t.detail.location&&h.add(t.detail.text,t.detail.location.geometry.coordinates[1],t.detail.location.geometry.coordinates[0])})),function(t){var e=document.getElementById("voice"),r=document.getElementById("rate");function n(){t.voices=window.speechSynthesis.getVoices().filter((function(t){return t.lang.startsWith("en")})),t.voices.forEach((function(t,r){var n=document.createElement("option");n.value=r,n.textContent="🗣 "+t.name,e.appendChild(n)}))}n();var o=t.voices.find((function(t){return t.default}));o&&(e.value=t.voices.indexOf(o)),window.speechSynthesis.onvoiceschanged=function(){e.innerHTML="",n()},r.addEventListener("input",(function(e){t.setRate(parseFloat(r.value))})),e.addEventListener("change",(function(){t.setVoice(e.value)})),t.setRate(parseFloat(r.value)),t.setVoice(e.value)}(o);var y=document.getElementById("btn_callouts"),v=document.getElementById("btn_near_me"),g=null,m=null,w="#18b3c3",b="#e74c3c";function x(t){return E.apply(this,arguments)}function E(){return(E=V(Q().mark((function t(e){return Q().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(f(" "),y.style.backgroundColor=b,v.style.backgroundColor=b,m&&(o.stopAndClear(),o.addToQueue({soundUrl:"app/sounds/mode_exit.wav"})),r.events.removeEventListener("locationUpdated",c.locationChanged),g&&(navigator.geolocation.clearWatch(g),window.removeEventListener("deviceorientation",r.updateOrientation),g=null),m!=e){t.next=9;break}return m=null,t.abrupt("return");case 9:m=e,o.addToQueue({soundUrl:"app/sounds/mode_enter.wav"}),t.t0=e,t.next="callouts"===t.t0?14:"near_me"===t.t0?19:22;break;case 14:return r.events.addEventListener("locationUpdated",c.locationChanged),z(r.updateOrientation),g=O(r.updateLocation),y.style.backgroundColor=w,t.abrupt("break",22);case 19:return v.style.backgroundColor=w,d().then((function(t){console.log(t),r.updateLocation(t.latitude,t.longitude),r.updateOrientation({alpha:t.heading}),c.calloutAllFeatures(t.latitude,t.longitude).then((function(t){t||o.addToQueue({text:"Nothing to call out right now"})}))})).catch((function(t){t.code==t.PERMISSION_DENIED?alert("Could not get your location. If you did not see a permission request, make sure your browser is not configured to always block location services."):console.error("Error getting current position: "+t.message)})),t.abrupt("break",22);case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}y.addEventListener("click",(function(){x("callouts")})),v.addEventListener("click",(function(){x("near_me")}))}))})();